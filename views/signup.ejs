<!DOCTYPE html>
<html lang="ko">
  <head>
    <%-include('include/head')%>
    <title>Signup</title>
    <!-- (todo) ë‚˜ì¤‘ì— Public/css ë¶„ë¦¬ -->
    <style>
      @import url('../public/css/common.css');

      main {
        display: flex;
        justify-content: center;
        flex-direction: column;
        align-items: center;
        padding: 50px 0;
      }
      .form-container {
        padding: 1rem;
        width: 100%;
        max-width: 400px;
      }
      #signup-button {
        border: 1px solid var(--color-secondary);
        padding: 10px;
      }
      #signup-button:hover {
        background-color: var(--color-secondary);
      }

      .info-wrapper {
        padding: 1rem;
      }

      #signupForm input {
        margin-bottom: 1rem;
        width: 300px;
        height: 42px;
        padding: 12px;
        border: 1px solid var(--color-secondary);
        border-radius: 9px;
      }
      .error-message {
        color: red;
        font-size: 0.8rem;
      }
    </style>
  </head>
  <body>
    <!-- í—¤ë” -->
    <%-include('include/header')%>

    <!-- ë³¸ë¬¸ì˜ì—­ (íšŒì›ê°€ì…) -->
    <main class="max-container">
      <h1>íšŒì›ê°€ì…</h1>
      <br />
      <div class="form-container">
        <form name="signupForm" id="signupForm">
          <!-- ì´ë©”ì¼ ì…ë ¥ -->
          <label for="email">ì´ë©”ì¼</label>
          <div class="info-wrapper">
            <input
              type="email"
              id="email"
              name="email"
              placeholder="ì˜ˆ: example@gmail.com"
              required
            />
          </div>

          <!-- ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ -->
          <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
          <div class="info-wrapper">
            <div class="passwordInput-wrapper">
              <input
                type="password"
                name="password"
                placeholder="ë¹„ë°€ë²ˆí˜¸(ì˜ë¬¸+ìˆ«ì+íŠ¹ìˆ˜ë¬¸ì 8ì ì´ìƒ)"
                required
              />
            </div>

            <div class="error-message" id="password-error"></div>
          </div>

          <!-- ë¹„ë°€ë²ˆí˜¸ í™•ì¸ -->
          <label for="confirmPassword">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
          <div class="info-wrapper">
            <input
              type="password"
              id="confirm-password"
              name="confirmPassword"
              placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸"
              required
            />
            <div class="error-message" id="confirmPasswordError"></div>
          </div>

          <!-- ë‹‰ë„¤ì„ ì…ë ¥ (ìë™ìœ¼ë¡œ ì±„ì›Œì§) -->
          <label for="nickname">ë‹‰ë„¤ì„</label>
          <div class="info-wrapper">
            <input
              type="text"
              id="nickname"
              name="nickname"
              placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."
              required
            />
            <div class="error-message" id="nickname-error"></div>
          </div>
          <!-- ê°€ì…í•˜ê¸° ë²„íŠ¼ -->
          <button type="button" id="signup-button">ê°€ì…í•˜ê¸°</button>
          <div id="error" class="error-message"></div>
        </form>
      </div>
    </main>

    <!-- footer -->
    <%- include('include/footer', { title: 'test' })%>
  </body>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.forms['signupForm'];
      const emailInput = form.email;
      const nicknameInput = form.nickname;
      const passwordInput = form.password;
      const confirmPasswordInput = form.confirmPassword;
      const signupButton = document.getElementById('signup-button');
      const errorMessage = document.getElementById('error');

      // ì´ë©”ì¼ ì…ë ¥ ì‹œ nickname ìë™ ì„¤ì •
      emailInput.addEventListener('input', () => {
        const email = emailInput.value;
        if (email.includes('@')) {
          const nickname = email.split('@')[0]; // @ ì•ë¶€ë¶„ ê°€ì ¸ì˜¤ê¸°
          nicknameInput.value = nickname;
        }
        // (todo) ì´ë©”ì¼ í˜•ì‹ ìœ íš¨ì„± ê²€ì‚¬
      });

      // íšŒì›ê°€ì…
      signupButton.addEventListener('click', async () => {
        const email = emailInput.value.trim();
        const password = passwordInput.value.trim();
        const confirmPassword = confirmPasswordInput.value.trim();
        const nickname = nicknameInput.value.trim();

        // ìœ íš¨ì„± ê²€ì‚¬
        if (!email || !password || !nickname) {
          alert('ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸, ë‹‰ë„¤ì„ì€ í•„ìˆ˜ ì…ë ¥ê°’ì…ë‹ˆë‹¤.');
          return;
        }
        if (password !== confirmPassword) {
          document.getElementById('confirmPasswordError').innerText =
            'ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜';
          return;
        }

        // ì„œë²„ë¡œ ë°ì´í„° ì „ì†¡
        const data = { email, password, nickname };
        console.log('íšŒì›ê°€ì… ë°ì´í„°', data);

        try {
          // POST /member/signup
          const res = await axios.post('/member/signup', data);

          if (res.data.isSuccess) {
            alert(res.data.message);
            window.location.href = '/auth/login';
          } else {
            errorMessage.innerText = res.data.message;
          }
        } catch (err) {
          const res = await axios.post('/member/signup', data);
          console.error('ğŸš¨íšŒì›ê°€ì… ìš”ì²­ ì¤‘ ì—ëŸ¬ ë°œìƒ:', err);
          errorMessage.innerText = res.data.message;
        }
      });
    });

    // (todo) ë¹„ë°€ë²ˆí˜¸ ë³´ì´ê¸°/ìˆ¨ê¸°ê¸° í† ê¸€
  </script>
</html>
