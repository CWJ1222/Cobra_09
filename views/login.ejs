<!DOCTYPE html>
<html lang="ko">
  <head>
    <%-include('include/head')%>
    <title><%#= title %></title>
    <!-- (todo) 나중에 public/css 분리 예정 -->
    <style>
      main {
        display: flex;
        justify-content: center;
        flex-direction: column;
        align-items: center;
      }
      button {
        cursor: pointer;
      }
      button:hover {
        background-color: var(--color-secondary);
      }
      .error-message {
        color: red;
      }
    </style>
  </head>
  <body>
    <!-- 헤더 -->
    <%- include('include/header') %>

    <!-- 본문 영역 (로그인) -->
    <main class="max-container">
      <br />
      <h1>여기는 로그인 페이지🏡</h1>
      <br />
      <form name="loginForm" id="loginForm">
        <p>테스트 ID: soo@naver.com, PW: 1234</p>
        <br />
        <span>ID</span>
        <input
          type="text"
          name="id"
          placeholder="이메일을 입력해주세요"
          required
        />
        <br />
        <br />
        <span>PW</span>
        <input
          type="password"
          name="pw"
          placeholder="비밀번호를 입력해주세요"
          required
        />
        <br /><br />
        <button type="button" id="login-button">로그인</button>
        <!-- (todo) 회원가입 페이지로 이동 -->
        <button type="button" id="register-button">회원가입</button>
        <div id="error" class="error-message"></div>
      </form>
    </main>

    <!-- footer -->
    <%- include('include/footer', { title: 'test' })%>
  </body>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const loginButton = document.getElementById('login-button');
      const registerButton = document.getElementById('register-button');

      loginButton.addEventListener('click', login);

      registerButton.addEventListener('click', () => {
        window.location.href = '/member/register';
      });
    });

    // 로그인 처리
    async function login(e) {
      e.preventDefault();

      const form = document.forms['loginForm'];
      const userId = form.id.value.trim();
      const password = form.pw.value.trim();

      // 유효성 검사
      if (!userId || !password) {
        document.getElementById('error').innerText =
          '아이디와 비밀번호를 모두 입력해주세요 🥹';
        return;
      }

      // 서버로 데이터 전송
      const data = { userId, password };
      console.log('로그인 데이터', data);

      try {
        const res = await axios.post('/auth/login', data);

        if (res.data.isLogin) {
          alert(res.data.message);
          window.location.href = '/';
        } else if (
          !res.data.isLogin &&
          res.data.message === '로그인 실패 했습니다.'
        ) {
          document.getElementById('error').innerText =
            '가입되지 않은 사용자입니다. 회원가입을 먼저 진행해주세요🥹';
        } else {
          document.getElementById('error').innerText = res.data.message;
        }
      } catch (err) {
        console.error('🚨로그인 요청 중 에러 발생:', err);
        document.getElementById('error').innerText = '🚨 서버 오류 발생';
      }
    }
  </script>
</html>
