<!DOCTYPE html>
<html lang="ko">
  <head>
    <%-include('include/head')%>
    <title><%#= title %></title>
    <!-- (todo) ë‚˜ì¤‘ì— public/css ë¶„ë¦¬ ì˜ˆì • -->
    <style>
      main {
        display: flex;
        justify-content: center;
        flex-direction: column;
        align-items: center;
      }
      button {
        cursor: pointer;
      }
      #login-button:hover {
        background-color: var(--color-secondary);
      }
      #register-button:hover {
        background-color: var(--color-secondary);
      }

      .oauthButton {
        width: 250px;
        height: 25px;
      }

      .oauthButton img {
        width: 100%;
        height: 100%;
        object-fit: contain;
      }

      .error-message {
        color: red;
      }
    </style>
  </head>
  <body>
    <!-- í—¤ë” -->
    <%- include('include/header') %>

    <!-- ë³¸ë¬¸ ì˜ì—­ (ë¡œê·¸ì¸) -->
    <main class="max-container">
      <br />
      <h1>ì—¬ê¸°ëŠ” ë¡œê·¸ì¸ í˜ì´ì§€ğŸ¡</h1>
      <br />
      <form name="loginForm" id="loginForm">
        <p>í…ŒìŠ¤íŠ¸ ID: soo@naver.com, PW: 1234</p>
        <br />
        <span>ID</span>
        <input
          type="text"
          name="id"
          placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
          required
        />
        <br />
        <br />
        <span>PW</span>
        <input
          type="password"
          name="pw"
          placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"
          required
        />
        <br /><br />

        <!-- ë¡œê·¸ì¸ ì˜ì—­ -->
        <div class="loginContainer">
          <button type="button" class="loginButton" id="login-button">
            ì´ë©”ì¼ ë¡œê·¸ì¸
          </button>
          <a class="loginButton" href="/auth/kakao">
            <img src="../public/img/oauthKakao.png" alt="ì¹´ì¹´ì˜¤ë¡œ ì‹œì‘í•˜ê¸°" />
          </a>
          <button type="button" class="loginButton">êµ¬ê¸€ ë¡œê·¸ì¸</button>
          <div id="error" class="error-message"></div>
        </div>

        <!-- ë°±ì—”ë“œ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ -->
        <a href="/auth/logout">ë¡œê·¸ì•„ì›ƒ</a>

        <!-- (todo) íšŒì›ê°€ì… í˜ì´ì§€ë¡œ ì´ë™ -->
        <button type="button" id="signup-button">íšŒì›ê°€ì…</button>
      </form>
    </main>

    <!-- footer -->
    <%- include('include/footer', { title: 'test' })%>
  </body>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const loginButton = document.getElementById('login-button');
      const signupButton = document.getElementById('signup-button');

      loginButton.addEventListener('click', login);

      signupButton.addEventListener('click', () => {
        window.location.href = '/member/signup';
        console.log('click');
      });
    });

    // ë¡œê·¸ì¸ ì²˜ë¦¬
    async function login(e) {
      e.preventDefault();

      const form = document.forms['loginForm'];
      const userId = form.id.value.trim();
      const password = form.pw.value.trim();

      // ìœ íš¨ì„± ê²€ì‚¬
      if (!userId || !password) {
        document.getElementById('error').innerText =
          'ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš” ğŸ¥¹';
        return;
      }

      // ì„œë²„ë¡œ ë°ì´í„° ì „ì†¡
      const data = { userId, password };
      console.log('ë¡œê·¸ì¸ ë°ì´í„°', data);

      try {
        const res = await axios.post('/auth', data);

        if (res.data.isLogin) {
          alert(res.data.message);
          window.location.href = '/';
        } else if (
          !res.data.isLogin &&
          res.data.message === 'ë¡œê·¸ì¸ ì‹¤íŒ¨ í–ˆìŠµë‹ˆë‹¤.'
        ) {
          document.getElementById('error').innerText =
            'ê°€ì…ë˜ì§€ ì•Šì€ ì‚¬ìš©ìì…ë‹ˆë‹¤. íšŒì›ê°€ì…ì„ ë¨¼ì € ì§„í–‰í•´ì£¼ì„¸ìš”ğŸ¥¹';
        } else {
          document.getElementById('error').innerText = res.data.message;
        }
      } catch (err) {
        console.error('ğŸš¨ë¡œê·¸ì¸ ìš”ì²­ ì¤‘ ì—ëŸ¬ ë°œìƒ:', err);
        document.getElementById('error').innerText = 'ğŸš¨ ì„œë²„ ì˜¤ë¥˜ ë°œìƒ';
      }
    }

    // ë°±ì—”ë“œ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë¡œê·¸ì•„ì›ƒ (todo) ì¶”í›„ ë§ˆì´í˜ì´ì§€ë¡œ ì´ë™
    function handleLogout() {
      axios({ method: 'delete', url: '/auth' }).then((res) =>
        console.log(res.data)
      );
    }
  </script>
</html>
